"use strict";

var playBtn = document.querySelector('.bonus__main-wheel-btn'),
  main = document.querySelector('.bonus__main'),
  wheel = document.querySelector('.bonus__main-wheel-reel'),
  mainWheel = document.querySelector('.bonus__main-wheel'),
  overlay = document.querySelector('.bonus__overlay'),
  popupFirst = document.querySelector('.bonus__firstWin'),
  popupFirstBtn = document.querySelector('.bonus__firstWin-btn'),
  popupSecond = document.querySelector('.bonus__secondWin'),
  overflow = document.querySelector('body'),
  wrapper = document.querySelector('.bonus'),
  rotateText = document.querySelector('.bonus__main-txt-center');
var triesCounter = 0;
var textAfterRotate = 'У тебе <span>1</span> спроба';
playBtn.addEventListener('click', function () {
  if (triesCounter === 0) {
    runFirstRotation();
    rotateText.innerHTML = textAfterRotate;
  } else {
    runSecondRotation();
  }
});
function runFirstRotation() {
  wheel.classList.add('reel-rotation-first');
  playBtn.classList.remove('pulse-btn');
  playBtn.style.cursor = 'default';
  wrapper.style.pointerEvents = 'none';
  setTimeout(function () {
    mainWheel.classList.add('_win');
  }, 6000);
  setTimeout(function () {
    doAfterFirstRotation();
  }, 8000);
  triesCounter++;
}
function doAfterFirstRotation() {
  wheel.style.transform = 'rotate(900deg)';
  wheel.classList.remove('reel-rotation-first');
  displayPopup(popupFirst);
  wrapper.style.pointerEvents = 'auto';
  overflow.style.overflow = 'hidden';
  setTimeout(function () {
    playBtn.classList.add('pulse-btn');
    playBtn.style.cursor = 'pointer';
  }, 1200);
}
function runSecondRotation() {
  wheel.classList.add('reel-rotation-second');
  playBtn.classList.remove('pulse-btn');
  playBtn.style.cursor = 'default';
  overflow.style.overflow = 'hidden';
  wrapper.style.pointerEvents = 'none';
  setTimeout(function () {
    mainWheel.classList.add('_win');
  }, 6000);
  setTimeout(function () {
    doAfterSecondRotation();
  }, 8000);
  triesCounter++;
}
function doAfterSecondRotation() {
  displayPopup(popupSecond);
  wrapper.style.pointerEvents = 'auto';
}
popupFirstBtn.addEventListener('click', function () {
  overlay.classList.add('opacity-overlay');
  popupFirst.classList.add('hide');
  overflow.style.overflow = 'unset';
  mainWheel.classList.remove('_win');
});
function displayPopup(popup) {
  overlay.classList.remove('opacity-overlay');
  popup.classList.remove('hide');
}
(function () {
  var url = new URL(window.location.href);
  var params = ['l', 'utm_source', 'utm_medium', 'utm_campaign', 'utm_term', 'utm_content', 'param1', 'param2', 'param3', 'param4', 'creative_type', 'creative_id'];
  var linkParams = ['affid', 'cpaid']; // ищем в url redirectUrl в url:

  if (url.searchParams.has('redirectUrl')) {
    var redirectUrl = new URL(url.searchParams.get('redirectUrl'));
    if (redirectUrl.href.match(/\//g).length === 4 && redirectUrl.searchParams.get('l')) {
      //если ссылка в ссылка redirectUrl корректная
      localStorage.setItem('redirectUrl', redirectUrl.href); // указываем точкой входа домен с протоколом из redirectUrl
    }
  }
  params.forEach(function (param) {
    if (url.searchParams.has(param)) localStorage.setItem(param, url.searchParams.get(param));
  });
  linkParams.forEach(function (linkParam) {
    if (url.searchParams.has(linkParam)) localStorage.setItem(linkParam, url.searchParams.get(linkParam));
  });
  window.addEventListener('click', function (e) {
    var link,
      parent = e.target.closest('a');
    if (parent.getAttribute('href') !== 'https://tds.favbet.partners') {
      return;
    }
    if (parent) {
      e.preventDefault();
      var affid = localStorage.getItem('affid');
      var cpaid = localStorage.getItem('cpaid');
      if (localStorage.getItem("redirectUrl")) {
        link = new URL(localStorage.getItem("redirectUrl"));
      } else {
        link = new URL(parent.href);
        if (affid && cpaid) {
          link.pathname = '/' + affid + '/' + cpaid;
        }
      }
      params.forEach(function (param) {
        if (url.searchParams.has(param)) {
          link.searchParams.set(param, localStorage.getItem(param));
        }
      });
      document.location.href = link;
    }
  });
})();
document.querySelector(".first-popup").addEventListener("click", function () {
  displayPopup(popupFirst);
});
document.querySelector(".second-popup").addEventListener("click", function () {
  displayPopup(popupSecond);
});
"use strict";
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiLCJzZWNvbmQuanMiXSwibmFtZXMiOlsicGxheUJ0biIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIm1haW4iLCJ3aGVlbCIsIm1haW5XaGVlbCIsIm92ZXJsYXkiLCJwb3B1cEZpcnN0IiwicG9wdXBGaXJzdEJ0biIsInBvcHVwU2Vjb25kIiwib3ZlcmZsb3ciLCJ3cmFwcGVyIiwicm90YXRlVGV4dCIsInRyaWVzQ291bnRlciIsInRleHRBZnRlclJvdGF0ZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJydW5GaXJzdFJvdGF0aW9uIiwiaW5uZXJIVE1MIiwicnVuU2Vjb25kUm90YXRpb24iLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW1vdmUiLCJzdHlsZSIsImN1cnNvciIsInBvaW50ZXJFdmVudHMiLCJzZXRUaW1lb3V0IiwiZG9BZnRlckZpcnN0Um90YXRpb24iLCJ0cmFuc2Zvcm0iLCJkaXNwbGF5UG9wdXAiLCJkb0FmdGVyU2Vjb25kUm90YXRpb24iLCJwb3B1cCIsInVybCIsIlVSTCIsIndpbmRvdyIsImxvY2F0aW9uIiwiaHJlZiIsInBhcmFtcyIsImxpbmtQYXJhbXMiLCJzZWFyY2hQYXJhbXMiLCJoYXMiLCJyZWRpcmVjdFVybCIsImdldCIsIm1hdGNoIiwibGVuZ3RoIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsImZvckVhY2giLCJwYXJhbSIsImxpbmtQYXJhbSIsImUiLCJsaW5rIiwicGFyZW50IiwidGFyZ2V0IiwiY2xvc2VzdCIsImdldEF0dHJpYnV0ZSIsInByZXZlbnREZWZhdWx0IiwiYWZmaWQiLCJnZXRJdGVtIiwiY3BhaWQiLCJwYXRobmFtZSIsInNldCJdLCJtYXBwaW5ncyI6Ijs7QUFDQSxJQUFNQSxPQUFPLEdBQUdDLFFBQVEsQ0FBQ0MsYUFBYSxDQUFDLHdCQUF3QixDQUFDO0VBQzFEQyxJQUFJLEdBQUdGLFFBQVEsQ0FBQ0MsYUFBYSxDQUFDLGNBQWMsQ0FBQztFQUM3Q0UsS0FBSyxHQUFHSCxRQUFRLENBQUND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QUMsQ0FBQ2EsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLFlBQUs7RUFDbEVhLFlBQVksQ0FBQ3JCLFVBQVUsQ0FBQztBQUM1QixDQUFDLENBQUM7QUFFRk4sUUFBUSxDQUFDQyxhQUFhLENBQUMsZUFBZSxDQUFDLENBQUNhLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxZQUFLO0VBQ25FYSxZQUFZLENBQUNuQixXQUFXLENBQUM7QUFDN0IsQ0FBQyxDQUFDO0FDdEpGIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbmNvbnN0IHBsYXlCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYm9udXNfX21haW4td2hlZWwtYnRuJyksXG4gICAgICBtYWluID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJvbnVzX19tYWluJyksXG4gICAgICB3aGVlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ib251c19fbWFpbi13aGVlbC1yZWVsJyksXG4gICAgICBtYWluV2hlZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYm9udXNfX21haW4td2hlZWwnKSxcbiAgICAgIG92ZXJsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYm9udXNfX292ZXJsYXknKSxcbiAgICAgIHBvcHVwRmlyc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYm9udXNfX2ZpcnN0V2luJyksXG4gICAgICBwb3B1cEZpcnN0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJvbnVzX19maXJzdFdpbi1idG4nKSxcbiAgICAgIHBvcHVwU2Vjb25kID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJvbnVzX19zZWNvbmRXaW4nKSxcbiAgICAgIG92ZXJmbG93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpLFxuICAgICAgd3JhcHBlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ib251cycpLFxuICAgICAgcm90YXRlVGV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ib251c19fbWFpbi10eHQtY2VudGVyJyk7XG5cblxubGV0IHRyaWVzQ291bnRlciA9IDBcbmxldCB0ZXh0QWZ0ZXJSb3RhdGUgPSAn0KMg0YLQtdCx0LUgPHNwYW4+MTwvc3Bhbj4g0YHQv9GA0L7QsdCwJztcblxucGxheUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBpZiAodHJpZXNDb3VudGVyID09PSAwKSB7XG4gICAgICAgIHJ1bkZpcnN0Um90YXRpb24oKVxuICAgICAgICByb3RhdGVUZXh0LmlubmVySFRNTCA9IHRleHRBZnRlclJvdGF0ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBydW5TZWNvbmRSb3RhdGlvbigpXG4gICAgfVxufSlcblxuZnVuY3Rpb24gcnVuRmlyc3RSb3RhdGlvbigpIHtcbiAgICB3aGVlbC5jbGFzc0xpc3QuYWRkKCdyZWVsLXJvdGF0aW9uLWZpcnN0JylcbiAgICBwbGF5QnRuLmNsYXNzTGlzdC5yZW1vdmUoJ3B1bHNlLWJ0bicpXG4gICAgcGxheUJ0bi5zdHlsZS5jdXJzb3IgPSAnZGVmYXVsdCdcbiAgICB3cmFwcGVyLnN0eWxlLnBvaW50ZXJFdmVudHMgPSAnbm9uZSdcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgbWFpbldoZWVsLmNsYXNzTGlzdC5hZGQoJ193aW4nKVxuICAgIH0sIDYwMDApXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGRvQWZ0ZXJGaXJzdFJvdGF0aW9uKClcbiAgICB9LCA4MDAwKVxuICAgIHRyaWVzQ291bnRlcisrXG59XG5cbmZ1bmN0aW9uIGRvQWZ0ZXJGaXJzdFJvdGF0aW9uKCkge1xuICAgIHdoZWVsLnN0eWxlLnRyYW5zZm9ybSA9ICdyb3RhdGUoOTAwZGVnKSdcbiAgICB3aGVlbC5jbGFzc0xpc3QucmVtb3ZlKCdyZWVsLXJvdGF0aW9uLWZpcnN0JylcbiAgICBkaXNwbGF5UG9wdXAocG9wdXBGaXJzdClcbiAgICB3cmFwcGVyLnN0eWxlLnBvaW50ZXJFdmVudHMgPSAnYXV0bydcbiAgICBvdmVyZmxvdy5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHBsYXlCdG4uY2xhc3NMaXN0LmFkZCgncHVsc2UtYnRuJylcbiAgICAgICAgcGxheUJ0bi5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcidcbiAgICB9LCAxMjAwKVxufVxuXG5mdW5jdGlvbiBydW5TZWNvbmRSb3RhdGlvbigpIHtcbiAgICB3aGVlbC5jbGFzc0xpc3QuYWRkKCdyZWVsLXJvdGF0aW9uLXNlY29uZCcpXG4gICAgcGxheUJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdwdWxzZS1idG4nKVxuICAgIHBsYXlCdG4uc3R5bGUuY3Vyc29yID0gJ2RlZmF1bHQnXG4gICAgb3ZlcmZsb3cuc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJ1xuICAgIHdyYXBwZXIuc3R5bGUucG9pbnRlckV2ZW50cyA9ICdub25lJ1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIG1haW5XaGVlbC5jbGFzc0xpc3QuYWRkKCdfd2luJylcbiAgICB9LCA2MDAwKVxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBkb0FmdGVyU2Vjb25kUm90YXRpb24oKVxuICAgIH0sIDgwMDApXG4gICAgdHJpZXNDb3VudGVyKytcbn1cblxuZnVuY3Rpb24gZG9BZnRlclNlY29uZFJvdGF0aW9uKCkge1xuICAgIGRpc3BsYXlQb3B1cChwb3B1cFNlY29uZClcbiAgICB3cmFwcGVyLnN0eWxlLnBvaW50ZXJFdmVudHMgPSAnYXV0bydcbn1cblxuXG5wb3B1cEZpcnN0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIG92ZXJsYXkuY2xhc3NMaXN0LmFkZCgnb3BhY2l0eS1vdmVybGF5JylcbiAgICBwb3B1cEZpcnN0LmNsYXNzTGlzdC5hZGQoJ2hpZGUnKVxuICAgIG92ZXJmbG93LnN0eWxlLm92ZXJmbG93ID0gJ3Vuc2V0J1xuICAgIG1haW5XaGVlbC5jbGFzc0xpc3QucmVtb3ZlKCdfd2luJylcbn0pXG5cbmZ1bmN0aW9uIGRpc3BsYXlQb3B1cChwb3B1cCkge1xuICAgIG92ZXJsYXkuY2xhc3NMaXN0LnJlbW92ZSgnb3BhY2l0eS1vdmVybGF5JylcbiAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJylcblxufVxuXG5cbihmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHVybCA9IG5ldyBVUkwod2luZG93LmxvY2F0aW9uLmhyZWYpO1xuICAgIHZhciBwYXJhbXMgPSBbJ2wnLCAndXRtX3NvdXJjZScsICd1dG1fbWVkaXVtJywgJ3V0bV9jYW1wYWlnbicsICd1dG1fdGVybScsICd1dG1fY29udGVudCcsICdwYXJhbTEnLCAncGFyYW0yJywgJ3BhcmFtMycsICdwYXJhbTQnLCAnY3JlYXRpdmVfdHlwZScsICdjcmVhdGl2ZV9pZCddO1xuICAgIHZhciBsaW5rUGFyYW1zID0gWydhZmZpZCcsICdjcGFpZCddOyAvLyDQuNGJ0LXQvCDQsiB1cmwgcmVkaXJlY3RVcmwg0LIgdXJsOlxuXG4gICAgaWYgKHVybC5zZWFyY2hQYXJhbXMuaGFzKCdyZWRpcmVjdFVybCcpKSB7XG4gICAgICAgIHZhciByZWRpcmVjdFVybCA9IG5ldyBVUkwodXJsLnNlYXJjaFBhcmFtcy5nZXQoJ3JlZGlyZWN0VXJsJykpO1xuXG4gICAgICAgIGlmIChyZWRpcmVjdFVybC5ocmVmLm1hdGNoKC9cXC8vZykubGVuZ3RoID09PSA0ICYmIHJlZGlyZWN0VXJsLnNlYXJjaFBhcmFtcy5nZXQoJ2wnKSkge1xuICAgICAgICAgICAgLy/QtdGB0LvQuCDRgdGB0YvQu9C60LAg0LIg0YHRgdGL0LvQutCwIHJlZGlyZWN0VXJsINC60L7RgNGA0LXQutGC0L3QsNGPXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncmVkaXJlY3RVcmwnLCByZWRpcmVjdFVybC5ocmVmKTsgLy8g0YPQutCw0LfRi9Cy0LDQtdC8INGC0L7Rh9C60L7QuSDQstGF0L7QtNCwINC00L7QvNC10L0g0YEg0L/RgNC+0YLQvtC60L7Qu9C+0Lwg0LjQtyByZWRpcmVjdFVybFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcGFyYW1zLmZvckVhY2goZnVuY3Rpb24gKHBhcmFtKSB7XG4gICAgICAgIGlmICh1cmwuc2VhcmNoUGFyYW1zLmhhcyhwYXJhbSkpIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHBhcmFtLCB1cmwuc2VhcmNoUGFyYW1zLmdldChwYXJhbSkpO1xuICAgIH0pO1xuXG4gICAgbGlua1BhcmFtcy5mb3JFYWNoKGZ1bmN0aW9uIChsaW5rUGFyYW0pIHtcbiAgICAgICAgaWYgKHVybC5zZWFyY2hQYXJhbXMuaGFzKGxpbmtQYXJhbSkpIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGxpbmtQYXJhbSwgdXJsLnNlYXJjaFBhcmFtcy5nZXQobGlua1BhcmFtKSk7XG4gICAgfSk7XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgbGluayxcbiAgICAgICAgICAgIHBhcmVudCA9IGUudGFyZ2V0LmNsb3Nlc3QoJ2EnKTtcblxuICAgICAgICBpZiAocGFyZW50LmdldEF0dHJpYnV0ZSgnaHJlZicpICE9PSAnaHR0cHM6Ly90ZHMuZmF2YmV0LnBhcnRuZXJzJykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHBhcmVudCkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdmFyIGFmZmlkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2FmZmlkJyk7XG4gICAgICAgICAgICB2YXIgY3BhaWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY3BhaWQnKTtcblxuICAgICAgICAgICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwicmVkaXJlY3RVcmxcIikpIHtcbiAgICAgICAgICAgICAgICBsaW5rID0gbmV3IFVSTChsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInJlZGlyZWN0VXJsXCIpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbGluayA9IG5ldyBVUkwocGFyZW50LmhyZWYpO1xuICAgICAgICAgICAgICAgIGlmIChhZmZpZCAmJiBjcGFpZCkge1xuICAgICAgICAgICAgICAgICAgICBsaW5rLnBhdGhuYW1lID0gJy8nICsgYWZmaWQgKyAnLycgKyBjcGFpZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHBhcmFtcy5mb3JFYWNoKGZ1bmN0aW9uIChwYXJhbSkge1xuICAgICAgICAgICAgICAgIGlmICh1cmwuc2VhcmNoUGFyYW1zLmhhcyhwYXJhbSkpIHtcbiAgICAgICAgICAgICAgICAgICAgbGluay5zZWFyY2hQYXJhbXMuc2V0KHBhcmFtLCBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShwYXJhbSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBkb2N1bWVudC5sb2NhdGlvbi5ocmVmID0gbGluaztcbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTtcblxuXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmZpcnN0LXBvcHVwXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PntcbiAgICBkaXNwbGF5UG9wdXAocG9wdXBGaXJzdClcbn0pXG5cbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc2Vjb25kLXBvcHVwXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PntcbiAgICBkaXNwbGF5UG9wdXAocG9wdXBTZWNvbmQpXG59KVxuXG4iLCIiXX0=
